<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ReuniteAI — Report Missing Items</title>
  <link rel="stylesheet" href="./styles/style.css" />
  <link rel="stylesheet" href="./styles/report.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://kit.fontawesome.com/cdfe75faaa.js" crossorigin="anonymous"></script>
</head>

<body>
  <header>
    <nav class="navbar">
      <div class="nav-section nav-left">
        <div class="logo">
          <a href="./index.html">ReuniteAI</a>
        </div>
      </div>
      <div class="nav-section nav-center">
        <a href="#">How It Works</a>
        <a href="#">About</a>
        <a href="#">Check Report Status</a>
      </div>
      <div class="nav-section nav-right">
        <a href="#" class="nav-auth">Log in</a>
        <a href="#" class="nav-auth outlined">Sign up</a>
      </div>
    </nav>
  </header>

  <main>
    <section class="report-section">
      <h1 class="report-title">Report a Lost Item</h1>
      <p class="report-subtitle">
        Let us help you recover your lost item with our AI-powered matching.
      </p>

      <form id="" class="report-form">
        <div class="form-group">
          <label for="item-image">Upload a Photo of the Lost item</label>
          <input type="file" id="item-image" accept="image/*" required aria-label="Upload photo of the lost item" />
          <div id="image-preview" class="image-preview">
            <span id="crop-icon" class="crop-icon"><i class="fa-solid fa-crop-simple"></i></span>
          </div>
        </div>

        <div class="form-group">
          <label for="item-description">Describe your item</label>
          <textarea id="item-description" placeholder="e.g., Red backpack, library, zipper broken" required
            aria-label="Description of the lost item"></textarea>
        </div>

        <div class="form-group">
          <label for="university-name">University</label>
          <input type="text" id="university-name" value="Federal University of Technology, Akure" readonly disabled
            aria-label="University name" />
          <input type="hidden" name="university" value="Federal University of Technology, Akure" />
        </div>

        <div class="form-group">
          <label for="item-location">
            Where did you lose it?
            <div class="info-container">
              <i class="fa-solid fa-circle-info"></i>
              <span class="info-text">
                We try to detect the name of the place you click on, but it may not always be accurate. Feel free to correct it manually.
              </span>
            </div>
          </label>
          <p>Select on the map or type location manually</p>
          <div id="map"></div>
          <input type="text" name="custom-location"
            placeholder="E.g. LT1, Engineering Building, Obakekere, Malu Road" />
          <input type="hidden" name="lat" id="lat" />
          <input type="hidden" name="lng" id="lng" />
        </div>

        <div class="form-group">
          <label for="item-date">When did you lose it?</label>
          <input type="date" id="item-date" required aria-label="Date the item was lost" />
        </div>

        <button type="submit" class="submit-button">
          Submit Lost Item Report
        </button>
      </form>

      <div id="successMessage" class="success-message" style="display: none">
        <p>
          Thanks! We’ve received your report. Our AI is now searching for a match. We’ll notify you if anything comes up.
        </p>
        <a href="./index.html" class="back-button">Back to Home</a>
      </div>
    </section>
  </main>

  <!-- cropper modal -->
  <div id="crop-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <span id="crop-close" class="close">&times;</span>
      <h3>Highlight the found item in the photo so we can reunite it faster</h3>
      <img id="crop-image" src="" alt="Crop area preview" style="max-width: 100%;" />
      <button id="crop-confirm" class="submit-button" style="margin-top: 12px;">Crop & Save</button>
    </div>
  </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<script src="./scripts/map.js"></script>
<script>
const imageInput = document.getElementById("item-image");
const previewImage = document.getElementById("image-preview");
const cropIcon = document.getElementById("crop-icon");

const cropModal = document.getElementById("crop-modal");
const cropImage = document.getElementById("crop-image");
const cropConfirm = document.getElementById("crop-confirm");
const cropClose = document.getElementById("crop-close");

let uploadedImageDataUrl = null;
let cropper;

imageInput.addEventListener("change", () => {
  previewImage.innerHTML = "";
  previewImage.appendChild(cropIcon);

  const file = imageInput.files[0];
  if (file && file.type.startsWith("image/")) {
    const reader = new FileReader();

    reader.onload = function (e) {
      uploadedImageDataUrl = e.target.result;
      const img = document.createElement("img");
      img.src = uploadedImageDataUrl;
      img.alt = "uploaded image preview";
      img.style.maxWidth = "100%";
      img.style.marginTop = "10px";
      previewImage.appendChild(img);
      cropIcon.style.display = "block";
    };

    reader.readAsDataURL(file);
  } else {
    cropIcon.style.display = "none";
  }
});

cropIcon.addEventListener("click", () => {
  if (!uploadedImageDataUrl) return;
  cropModal.style.display = "flex";
  cropImage.src = uploadedImageDataUrl;

  cropImage.onload = () => {
    if (cropper) cropper.destroy();
    cropper = new Cropper(cropImage, {
      aspectRatio: 1,
      viewMode: 1,
      dragMode: "move",
      autoCropArea: 1,
      cropBoxResizable: false,
      cropBoxMovable: true,
      ready() {
        const cropBoxData = cropper.getCropBoxData();
        cropper.setCropBoxData({
          width: 224,
          height: 224,
          left: cropBoxData.left,
          top: cropBoxData.top,
        });
      },
    });
  };
});

cropClose.addEventListener("click", () => {
  cropModal.style.display = "none";
  if (cropper) cropper.destroy();
});

cropConfirm.addEventListener("click", () => {
  if (!cropper) return;
  const canvas = cropper.getCroppedCanvas({ width: 224, height: 224 });
  const croppedImg = document.createElement("img");
  croppedImg.src = canvas.toDataURL("image/jpeg");
  croppedImg.alt = "cropped image";

  previewImage.innerHTML = "";
  previewImage.appendChild(cropIcon);
  previewImage.appendChild(croppedImg);
  cropModal.style.display = "none";

  uploadedImageDataUrl = croppedImg.src;
  if (cropper) cropper.destroy();
});

cropModal.addEventListener("click", (event) => {
  if (event.target === cropModal) {
    cropModal.style.display = "none";
    if (cropper) cropper.destroy();
  }
});
</script>
</html>
</html>